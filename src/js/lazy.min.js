(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.lazyload=a()})(function(){return lazyload=function(){return function(a){var b=this;for(var c in b.options=a||{},b.defaults={elements:".lazy",srcAttr:"data-src",mediaAttr:"data-media",clearSrc:!1,clearMedia:!1},b.elements=[],b.currentPixelRatio={},b.imageObserver=null,b.resizeHandler={handleEvent:b.windowResizeEvent,ctx:b},b.defaults)void 0===b.options[c]&&(b.options[c]=b.defaults[c]);b.init()}}(),lazyload.prototype.init=function(){var a=this;a.createImgLazyObject(),a.getPxRatio(),a.createObserver(),a.startObserve(),window.addEventListener("resize",a.resizeHandler)},lazyload.prototype.createImgLazyObject=function(a){for(var b=this,c=b.options,d=a||document.querySelectorAll(c.elements),e=/\n|\t|\s{2,}/gm,f=/\(max\-width.*?\)|\(min\-width.*?\)/g,g=/\{.*?\}/g,h={imgSet:/image-set\((.*?)\)/,pxRatio:/[0-9.]+x$/,src:/.*(?=\s[0-9.]+x$)/,split:/\,\s|\,/},k=0;k<d.length;k++){var l=d[k].getAttribute(c.mediaAttr),m=d[k].getAttribute(c.srcAttr),n=d[k].getAttribute("data-lazy-clear-media"),o=d[k].getAttribute("data-lazy-clear-src"),p=void 0,q=void 0;if(d[k].lazyObject={src:b.imgSrcParse(m,h),media:{},lazyTimer:null},l){l=l.replace(e,""),p=l.match(f),q=l.match(g);var r=d[k].lazyObject.media;r.length=p.length;for(var s=0;s<r.length;s++)r[p[s]]=b.imgSrcParse(q[s].slice(1,-1),h);(c.clearMedia||"true"==n)&&"false"!=n&&d[k].removeAttribute(c.mediaAttr)}if((c.clearSrc||"true"==o)&&"false"!=o&&d[k].removeAttribute(c.srcAttr),b.elements.push(d[k]),"function"==typeof window.CustomEvent){var j=new CustomEvent("lazyinit");d[k].dispatchEvent(j)}}},lazyload.prototype.imgSrcParse=function(a,b){this;if(-1!==a.search("image-set")){for(var c={},d=a.replace(b.imgSet,"$1"),e=d.split(b.split),f=0;f<e.length;f++){var g=e[f].match(b.pxRatio)[0],h=e[f].match(b.src)[0];c[g]=h}return c}return a},lazyload.prototype.getPxRatio=function(){for(var a,b,c=this,d=+window.devicePixelRatio.toFixed(1),e=1;10>e;e++)if(1==e){if(d<=e){a=e+"x",b=e;break}}else if(d>e-1&&d<=e){a=e+"x",b=e;break}c.currentPixelRatio.str=a,c.currentPixelRatio.num=b},lazyload.prototype.createObserver=function(){var a=this;a.imageObserver=new IntersectionObserver(function(b){b.forEach(function(b){if(b.isIntersecting){var c=b.target,d=c.getAttribute("data-lazy-delay");d?c.lazyObject.lazyTimer=setTimeout(function(){a.setImg(c)},+d):a.setImg(c)}})})},lazyload.prototype.startObserve=function(a){for(var b=this,c=a||b.elements,d=0;d<c.length;d++)b.imageObserver.observe(c[d])},lazyload.prototype.setImg=function(a){var b,c=this,d=a.lazyObject.src,e=a.lazyObject.media,f="";for(var h in e)"length"!=h&&matchMedia(h).matches&&(b=h);var g=b?e[b]:f?"":d;if("string"==typeof g)f=g;else{var j=g[c.currentPixelRatio.str];if(!j)for(var k=1;10>k;k++){var i=c.currentPixelRatio.num-k+"x",l=g[i];if(l){j=l;break}}f=j}switch(a.tagName.toLowerCase()){case"img":a.src=f;break;case"header":case"section":case"footer":case"main":case"div":case"span":case"button":case"form":case"article":a.style.backgroundImage=f;}if(a.classList.add("lazyloaded"),"function"==typeof window.CustomEvent){var m=new CustomEvent("lazyloaded");a.dispatchEvent(m)}c.imageObserver.unobserve(a)},lazyload.prototype.windowResizeEvent=function(){var a=this.ctx||this,b=a.elements;a.getPxRatio();for(var c=0;c<b.length;c++)clearTimeout(b[c].lazyObject.lazyTimer),a.imageObserver.unobserve(b[c]),a.imageObserver.observe(b[c])},lazyload.prototype.destroy=function(){var a=this;window.removeEventListener("resize",a.resizeHandler),a.imageObserver.disconnect();for(var b=0;b<a.elements.length;b++)clearTimeout(a.elements[b].lazyObject.lazyTimer),a.setImg(a.elements[b]),delete a.elements[b].lazyObject;a.elements=[],a.currentPixelRatio={},a.imageObserver=null},lazyload.prototype.refresh=function(){for(var a=this,b=document.querySelectorAll(a.options.elements),c=[],d=0;d<b.length;d++)b[d].lazyObject||c.push(b[d]);a.createImgLazyObject(c),a.startObserve(c),window.removeEventListener("resize",a.resizeHandler),window.addEventListener("resize",a.resizeHandler)},lazyload});